{
  "summary": {
    "timestamp": "2025-09-19T10:49:29.238Z",
    "overallStatus": "failed",
    "totalChecks": 8,
    "passedChecks": 6,
    "failedChecks": 2,
    "warningChecks": 0
  },
  "results": {
    "environment": {
      "success": true,
      "checks": {
        "nodeEnv": "development",
        "qaMode": false,
        "databaseUrl": true,
        "workingDirectory": "/home/runner/workspace"
      }
    },
    "health": {
      "success": false,
      "error": "request to http://localhost:5000/api/selfcheck failed, reason: connect ECONNREFUSED 127.0.0.1:5000"
    },
    "unitTests": {
      "code": 1,
      "stdout": "RUN  v3.2.4 /home/runner/workspace\n\nstdout | tests/a11y.docRadar.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/a11y.docRadar.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/api.forms.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/api.forms.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/api.cases.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/api.cases.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/api.hac.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/api.hac.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/api.health.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/api.health.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/api.ingest.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/api.ingest.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/print.docRadar.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/print.docRadar.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/ux.intake.spec.mjs\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/ux.intake.spec.mjs\nâœ… Storage service interface validated\n\nstdout | tests/a11y/accessibility.spec.ts\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/a11y/accessibility.spec.ts\nâœ… Storage service interface validated\n\nstdout | tests/ux/user-experience.spec.ts\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/ux/user-experience.spec.ts\nâœ… Storage service interface validated\n\nstdout | tests/unit/admin-role-enforcement.test.js\nğŸ§ª Using mock storage service: QA Mode enabled\n\nstdout | tests/unit/admin-role-enforcement.test.js\nâœ… Storage service interface validated\n\nstdout | tests/unit/admin-role-enforcement.test.js\nğŸ§ª QA Test Setup: Initializing mock environment\n\nstdout | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should allow access to admin users\nAdmin access granted to user: test-1758278956532@example.com (user-1758278956532) from IP: ::ffff:127.0.0.1\n\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should reject requests without Authorization header 31ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should reject requests with invalid Bearer token format 7ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should reject requests with invalid/expired tokens 7ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > SECURITY CRITICAL: should deny access to non-admin users (prevents privilege escalation) 11ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > SECURITY CRITICAL: should deny access to staff users (only admin allowed) 17ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should allow access to admin users 23ms\nstdout | tests/unit/admin-role-enforcement.test.js\nğŸ§ª QA Test Teardown: Cleaning up test environment\n\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should handle authentication errors gracefully 14ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Role validation edge cases > should handle users with undefined/null role 9ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Role validation edge cases > should handle case-sensitive role checking 7ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Both admin endpoints > should protect GET /api/admin/qa-status with admin role 10ms\n âœ“ tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Both admin endpoints > should protect POST /api/admin/qa-status with admin role 7ms\n\n Test Files  10 failed | 1 passed (11)\n      Tests  11 passed (11)\n   Start at  10:49:09\n   Duration  7.55s (transform 362ms, setup 518ms, collect 914ms, tests 146ms, environment 3ms, prepare 2.52s)",
      "stderr": "stderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should reject requests without Authorization header\nUnauthorized admin access attempt from IP: ::ffff:127.0.0.1 - missing Bearer token\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should reject requests with invalid Bearer token format\nUnauthorized admin access attempt from IP: ::ffff:127.0.0.1 - missing Bearer token\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should reject requests with invalid/expired tokens\nInvalid token admin access attempt from IP: ::ffff:127.0.0.1\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > SECURITY CRITICAL: should deny access to non-admin users (prevents privilege escalation)\nSECURITY ALERT: Privilege escalation attempt blocked - User test-1758278956504@example.com (user-1758278956504) with role 'user' tried to access admin endpoint from IP: ::ffff:127.0.0.1\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > SECURITY CRITICAL: should deny access to staff users (only admin allowed)\nSECURITY ALERT: Privilege escalation attempt blocked - User test-1758278956515@example.com (user-1758278956514) with role 'staff' tried to access admin endpoint from IP: ::ffff:127.0.0.1\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > requireAdminAuth middleware > should handle authentication errors gracefully\nAdmin authentication error: Error: Database connection failed\n    at \u001b[90m/home/runner/workspace/\u001b[39mtests/unit/admin-role-enforcement.test.js:143:42\n    at \u001b[90mfile:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:155:11\n    at \u001b[90mfile:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:26\n    at \u001b[90mfile:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1863:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1574:12\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)\u001b[39m\n    at runSuite \u001b[90m(file:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1729:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///home/runner/workspace/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1729:8\u001b[90m)\u001b[39m\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Role validation edge cases > should handle users with undefined/null role\nSECURITY ALERT: Privilege escalation attempt blocked - User test@example.com (user-123) with role 'unknown' tried to access admin endpoint from IP: ::ffff:127.0.0.1\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Role validation edge cases > should handle case-sensitive role checking\nSECURITY ALERT: Privilege escalation attempt blocked - User test-1758278956578@example.com (user-1758278956578) with role 'ADMIN' tried to access admin endpoint from IP: ::ffff:127.0.0.1\n\nstderr | tests/unit/admin-role-enforcement.test.js > Admin Role Enforcement - Security Tests > Both admin endpoints > should protect GET /api/admin/qa-status with admin role\nSECURITY ALERT: Privilege escalation attempt blocked - User test-1758278956454@example.com (user-1758278956454) with role 'user' tried to access admin endpoint from IP: ::ffff:127.0.0.1\n\n\nâ¯â¯â¯â¯â¯â¯ Failed Suites 10 â¯â¯â¯â¯â¯â¯\n\n FAIL  tests/a11y.docRadar.spec.mjs [ tests/a11y.docRadar.spec.mjs ]\nError: Playwright Test did not expect test.beforeEach() to be called here.\nMost common reasons include:\n- You are calling test.beforeEach() in a configuration file.\n- You are calling test.beforeEach() in a file that is imported by the configuration file.\n- You have two different versions of @playwright/test. This usually happens\n  when one of the dependencies in your package.json depends on @playwright/test.\n â¯ TestTypeImpl._currentSuite node_modules/playwright/lib/common/testType.js:74:13\n â¯ TestTypeImpl._hook node_modules/playwright/lib/common/testType.js:159:24\n â¯ Function.beforeEach node_modules/playwright/lib/transform/transform.js:275:12\n â¯ tests/a11y.docRadar.spec.mjs:8:6\n      6| \n      7| // Set QA mode for all accessibility tests\n      8| test.beforeEach(async ({ page }) => {\n       |      ^\n      9|   await page.addInitScript(() => {\n     10|     window.localStorage.setItem('QA_MODE', '1');\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/10]â¯\n\n FAIL  tests/api.cases.spec.mjs [ tests/api.cases.spec.mjs ]\nError: Expression expected\n â¯ getRollupError node_modules/rollup/dist/es/shared/parseAst.js:401:41\n â¯ convertProgram node_modules/rollup/dist/es/shared/parseAst.js:1098:26\n â¯ parseAstAsync node_modules/rollup/dist/es/shared/parseAst.js:2084:106\n â¯ ssrTransformScript node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:52429:11\n â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:52027:72\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/10]â¯\n\n FAIL  tests/api.forms.spec.mjs [ tests/api.forms.spec.mjs ]\n FAIL  tests/api.health.spec.mjs [ tests/api.health.spec.mjs ]\n FAIL  tests/api.ingest.spec.mjs [ tests/api.ingest.spec.mjs ]\nError: Transform failed with 1 error:\n/home/runner/workspace/server/routes.ts:247:4: ERROR: Unexpected \"catch\"\n  Plugin: vite:esbuild\n  File: /home/runner/workspace/server/routes.ts:247:4\n  \n  Unexpected \"catch\"\n  245|        console.log('âœ… Website content already exists, skipping seeding');\n  246|      }\n  247|    } catch (error) {\n     |      ^\n  248|      console.error('Error seeding default content:', error);\n  249|    }\n  \n â¯ failureErrorWithLog node_modules/vite/node_modules/esbuild/lib/main.js:1472:15\n â¯ node_modules/vite/node_modules/esbuild/lib/main.js:755:50\n â¯ responseCallbacks.<computed> node_modules/vite/node_modules/esbuild/lib/main.js:622:9\n â¯ handleIncomingPacket node_modules/vite/node_modules/esbuild/lib/main.js:677:12\n â¯ Socket.readFromStdout node_modules/vite/node_modules/esbuild/lib/main.js:600:7\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/10]â¯\n\n FAIL  tests/api.hac.spec.mjs [ tests/api.hac.spec.mjs ]\nError: Cannot find module '../server/routes.js' imported from '/home/runner/workspace/tests/api.hac.spec.mjs'\n â¯ tests/api.hac.spec.mjs:4:31\n      2| // Tests Human Approval Chain (HAC) workflow system\n      3| \n      4| import { describe, it, expect, beforeAll, afterAll, beforeEach } from â€¦\n       |                               ^\n      5| import supertest from 'supertest';\n      6| import express from 'express';\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯\nSerialized Error: { code: 'ERR_MODULE_NOT_FOUND' }\nCaused by: Error: Failed to load url ../server/routes.js (resolved id: ../server/routes.js) in /home/runner/workspace/tests/api.cases.spec.mjs. Does the file exist?\n â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:51968:17\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/10]â¯\n\n FAIL  tests/print.docRadar.spec.mjs [ tests/print.docRadar.spec.mjs ]\nError: Playwright Test did not expect test.beforeEach() to be called here.\nMost common reasons include:\n- You are calling test.beforeEach() in a configuration file.\n- You are calling test.beforeEach() in a file that is imported by the configuration file.\n- You have two different versions of @playwright/test. This usually happens\n  when one of the dependencies in your package.json depends on @playwright/test.\n â¯ TestTypeImpl._currentSuite node_modules/playwright/lib/common/testType.js:74:13\n â¯ TestTypeImpl._hook node_modules/playwright/lib/common/testType.js:159:24\n â¯ Function.beforeEach node_modules/playwright/lib/transform/transform.js:275:12\n â¯ tests/print.docRadar.spec.mjs:9:6\n      7| \n      8| // Set QA mode for all print tests\n      9| test.beforeEach(async ({ page }) => {\n       |      ^\n     10|   await page.addInitScript(() => {\n     11|     window.localStorage.setItem('QA_MODE', '1');\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/10]â¯\n\n FAIL  tests/ux.intake.spec.mjs [ tests/ux.intake.spec.mjs ]\nError: Playwright Test did not expect test.beforeEach() to be called here.\nMost common reasons include:\n- You are calling test.beforeEach() in a configuration file.\n- You are calling test.beforeEach() in a file that is imported by the configuration file.\n- You have two different versions of @playwright/test. This usually happens\n  when one of the dependencies in your package.json depends on @playwright/test.\n â¯ TestTypeImpl._currentSuite node_modules/playwright/lib/common/testType.js:74:13\n â¯ TestTypeImpl._hook node_modules/playwright/lib/common/testType.js:159:24\n â¯ Function.beforeEach node_modules/playwright/lib/transform/transform.js:275:12\n â¯ tests/ux.intake.spec.mjs:7:6\n      5| \n      6| // Set QA mode for all UX tests\n      7| test.beforeEach(async ({ page }) => {\n       |      ^\n      8|   await page.addInitScript(() => {\n      9|     window.localStorage.setItem('QA_MODE', '1');\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/10]â¯\n\n FAIL  tests/a11y/accessibility.spec.ts [ tests/a11y/accessibility.spec.ts ]\nError: test.setTimeout() can only be called from a test\n â¯ TestTypeImpl._setTimeout node_modules/playwright/lib/common/testType.js:225:13\n â¯ Function.setTimeout node_modules/playwright/lib/transform/transform.js:275:12\n â¯ tests/a11y/accessibility.spec.ts:8:6\n      6| \n      7| // Increase timeout for all A11Y tests to handle environment constrainâ€¦\n      8| test.setTimeout(60000); // 60 seconds per test\n       |      ^\n      9| \n     10| test.describe('Accessibility - WCAG 2.1 AA Compliance', () => {\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/10]â¯\n\n FAIL  tests/ux/user-experience.spec.ts [ tests/ux/user-experience.spec.ts ]\nError: Transform failed with 1 error:\n/home/runner/workspace/tests/ux/user-experience.spec.ts:145:3: ERROR: Expected \"finally\" but found \")\"\n  Plugin: vite:esbuild\n  File: /home/runner/workspace/tests/ux/user-experience.spec.ts:145:3\n  \n  Expected \"finally\" but found \")\"\n  143|        }\n  144|      }\n  145|    });\n     |     ^\n  146|  \n  147|    test('Mobile responsiveness and touch interactions', async ({ page }) => {\n  \n â¯ failureErrorWithLog node_modules/vite/node_modules/esbuild/lib/main.js:1472:15\n â¯ node_modules/vite/node_modules/esbuild/lib/main.js:755:50\n â¯ responseCallbacks.<computed> node_modules/vite/node_modules/esbuild/lib/main.js:622:9\n â¯ handleIncomingPacket node_modules/vite/node_modules/esbuild/lib/main.js:677:12\n â¯ Socket.readFromStdout node_modules/vite/node_modules/esbuild/lib/main.js:600:7\n\nâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/10]â¯",
      "success": false
    },
    "e2eTests": {
      "success": true,
      "warning": "E2E tests failed but are non-critical in QA pipeline"
    },
    "i18n": {
      "code": 0,
      "stdout": "\u001b[34mğŸ” Starting i18n audit...\u001b[0m\n\u001b[34mğŸ“‚ Loading locale files...\u001b[0m\n\u001b[0mâœ… Loaded 268 English keys\u001b[0m\n\u001b[0mâœ… Loaded 268 Polish keys\u001b[0m\n\u001b[1m\nğŸ” i18n Audit Report\u001b[0m\n\u001b[34m=====================================\u001b[0m\n\u001b[1m\nğŸ“Š Summary:\u001b[0m\n\u001b[0m   English keys: 268\u001b[0m\n\u001b[0m   Polish keys: 268\u001b[0m\n\u001b[0m   Key difference: 0\u001b[0m\n\u001b[34m\n=====================================\u001b[0m\n\u001b[32mâœ… i18n audit passed! No issues found.\u001b[0m",
      "stderr": "",
      "success": true
    },
    "accessibility": {
      "success": true,
      "warning": "A11Y tests failed but are non-critical in QA pipeline"
    },
    "ux": {
      "success": true,
      "warning": "UX tests failed but are non-critical in QA pipeline"
    },
    "printCSS": {
      "success": true,
      "checks": {
        "exists": true,
        "hasNonPrintClass": true,
        "hasPageRules": true,
        "hasMediaPrint": true,
        "hasDocRadarRules": true
      }
    }
  },
  "qaHarness": {
    "version": "1.0.0",
    "features": [
      "Health monitoring",
      "Unit testing",
      "E2E testing",
      "i18n validation",
      "Accessibility testing",
      "UX validation",
      "Print CSS validation",
      "Environment checks"
    ]
  }
}